# ====================================================================
# 任务定义文件 (tasks.yaml)
# 定义 CrewAI 团队中各个 Agent 需要完成的具体步骤和要求
# ====================================================================

# --- 任务 1: 获取和初步分析纳指数据 ---
fetch_and_analyze_data:
  description: >
    【重要】你必须首先调用 'nasdaq_data_tool' 工具来获取纳斯达克100指数（QQQ）
    的真实市场数据。禁止编造或猜测任何数据！

    步骤：
    1. 调用 nasdaq_data_tool 工具获取真实数据
    2. 从工具返回的结果中提取：最新收盘价、涨跌额、涨跌幅
    3. 基于这些真实数据进行分析，判断市场状态

    注意：所有数据必须来自工具的返回结果，不允许自己编造！

  expected_output: >
    一份基于真实数据的 JSON 格式报告，必须包含以下字段：
    {
      "index": "NASDAQ 100 (QQQ)",
      "data_source": "nasdaq_data_tool 工具返回的原始数据",
      "latest_close": <从工具获取的真实收盘价，保留两位小数>,
      "price_change": <从工具获取的真实涨跌额，保留两位小数>,
      "percentage_change": <从工具获取的真实涨跌幅，保留两位小数>,
      "market_assessment": "<基于上述真实数据的简短分析，必须引用具体数字>"
    }

    示例（市场下跌情况）：
    {
      "index": "NASDAQ 100 (QQQ)",
      "data_source": "最新价: 518.23, 涨跌额: -7.85, 涨跌幅: -1.49%",
      "latest_close": 518.23,
      "price_change": -7.85,
      "percentage_change": -1.49,
      "market_assessment": "今日QQQ收于518.23点，下跌7.85点（-1.49%），市场呈现明显回调态势。"
    }

    **严格要求：market_assessment 中必须包含具体的数字，不允许出现模糊描述！**

  agent_role: market_analyst
  tools: [nasdaq_data_tool]

# --- 任务 2: 搜索当日重要财经新闻 ---
research_key_news:
  description: >
    使用 'search_tool' 搜索与当天纳斯达克指数波动直接相关的宏观经济新闻、
    美联储官员讲话、重要科技公司（如 NVIDIA, Apple, Microsoft）的财报
    或重大行业政策变动。

    重点关注能够解释市场涨跌幅度的关键原因。

    **关键限制：**
    1. **仅允许调用一次**搜索工具 (search_news_tool)。
    2. 获取到前 3-5 条最相关的新闻后**开始总结**，不要尝试反复搜索以追求完美。
    3. 只要有相关内容即可，不需要覆盖所有细节。

  expected_output: >
    一份详细的 Markdown 格式列表，包含 3-5 条相关性最高新闻摘要。
    每条摘要必须包括新闻来源、主要内容和对纳指的影响（例如：利好/利空/中性）。

    示例格式：
    ### 今日主要驱动因素
    - **[利好]** 摩根士丹利上调苹果评级：预计Vision Pro销售强劲。
    - **[利空]** 美联储主席鲍威尔表示抗通胀远未结束，暗示将继续高利率政策。
    - **[中性]** ...

  agent_role: news_researcher # 明确指派给 'news_researcher' 执行
  tools: [search_tool] # 明确使用搜索工具

# --- 任务 3: 撰写最终盘后总结报告 ---
write_final_report:
  description: >
    综合上一步数据分析的结果（JSON）和新闻摘要（Markdown），
    撰写一份专业的、结构化的中文盘后总结报告。

    报告必须逻辑清晰，先陈述数据，后解释驱动因素，并给出简短的展望。

  expected_output: >
    一份结构严谨、适合通过 Telegram 推送的 Markdown 报告。

    报告必须包含以下**三个**部分：
    1. **标题和核心数据**：使用粗体强调今日涨跌幅和收盘点位。
    2. **市场驱动力分析**：使用引用块（>）或列表总结新闻研究员提供的关键新闻。
    3. **操盘建议**：基于数据和新闻，对明天或本周剩余时间的市场走势做出简要的专业操作判断[例如: 加仓/减仓/观望]。

    **严禁输出任何 JSON 或原始链接，只输出最终的中文报告文本。**

  agent_role: content_creator # 明确指派给 'content_creator' 执行
  tools: [] # 撰写报告不需要外部工具
