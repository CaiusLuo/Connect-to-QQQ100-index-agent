# ====================================================================
# 任务定义文件 (tasks.yaml)
# 定义 CrewAI 团队中各个 Agent 需要完成的具体步骤和要求
# ====================================================================

# --- 任务 1: 获取和初步分析纳指数据 ---
fetch_and_analyze_data:
  description: >
    使用 'nasdaq_data_tool' 工具获取纳斯达克100指数（QQQ）在过去一个交易日的
    收盘价、开盘价、成交量以及具体的百分比涨跌幅。

    分析并判断市场是处于上涨、下跌还是窄幅震荡状态。

  expected_output: >
    一份简洁的 JSON 格式输出，包含以下字段：
    {
      "index": "NASDAQ 100 (QQQ)",
      "latest_close": 0.00,  # 确保是两位小数
      "percentage_change": 0.00, # 确保是两位小数，例如 -1.58
      "volume": 0,
      "market_assessment": "例如：当日市场表现强劲，突破了关键阻力位。"
    }
    **严格确保输出是有效的 JSON 格式，以便下一个 Agent 读取。**

  agent_role: market_analyst # 明确指派给 'market_analyst' 执行
  tools: [nasdaq_data_tool] # 明确使用你定义的金融工具

# --- 任务 2: 搜索当日重要财经新闻 ---
research_key_news:
  description: >
    使用 'search_tool' 搜索与当天纳斯达克指数波动直接相关的宏观经济新闻、
    美联储官员讲话、重要科技公司（如 NVIDIA, Apple, Microsoft）的财报
    或重大行业政策变动。

    重点关注能够解释市场涨跌幅度的关键原因。

  expected_output: >
    一份详细的 Markdown 格式列表，包含至少 3-5 条关键新闻摘要。
    每条摘要必须包括新闻来源、主要内容和对纳指的影响（例如：利好/利空）。

    示例格式：
    ### 今日主要驱动因素
    - **[利好]** 摩根士丹利上调苹果评级：预计Vision Pro销售强劲。
    - **[利空]** 美联储主席鲍威尔表示抗通胀远未结束，暗示将继续高利率政策。
    - **[中性]** ...

  agent_role: news_researcher # 明确指派给 'news_researcher' 执行
  tools: [search_tool] # 明确使用搜索工具

# --- 任务 3: 撰写最终盘后总结报告 ---
write_final_report:
  description: >
    综合上一步数据分析的结果（JSON）和新闻摘要（Markdown），
    撰写一份专业的、结构化的中文盘后总结报告。

    报告必须逻辑清晰，先陈述数据，后解释驱动因素，并给出简短的展望。

  expected_output: >
    一份结构严谨、适合通过 Telegram 推送的 Markdown 报告。

    报告必须包含以下**三个**部分：
    1. **标题和核心数据**：使用粗体强调今日涨跌幅和收盘点位。
    2. **市场驱动力分析**：使用引用块（>）或列表总结新闻研究员提供的关键新闻。
    3. **简短展望**：基于数据和新闻，对明天或本周剩余时间的市场走势做出简要的专业判断。

    **严禁输出任何 JSON 或原始链接，只输出最终的中文报告文本。**

  agent_role: content_creator # 明确指派给 'content_creator' 执行
  tools: [] # 撰写报告不需要外部工具
