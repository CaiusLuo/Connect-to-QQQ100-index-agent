# ====================================================================
# 任务定义文件 (tasks.yaml)
# 定义 CrewAI 团队中各个 Agent 需要完成的具体步骤和要求
# ====================================================================

# --- 任务 1: 获取和初步分析纳指数据 ---
fetch_and_analyze_data:
  description: >
    【重要】你必须首先调用 'nasdaq_data_tool' 工具来获取纳斯达克100指数（QQQ）
    的真实市场数据。禁止编造或猜测任何数据！

    步骤：
    1. 调用 nasdaq_data_tool 工具获取真实数据
    2. 从工具返回的结果中提取：最新收盘价、涨跌额、涨跌幅
    3. 基于这些真实数据进行分析，判断市场状态

    注意：所有数据必须来自工具的返回结果，不允许自己编造！

  expected_output: >
    一份基于真实数据的 JSON 格式报告，必须包含以下字段：
    {
      "index": "NASDAQ 100 (QQQ)",
      "data_source": "nasdaq_data_tool 工具返回的原始数据",
      "latest_close": <从工具获取的真实收盘价，保留两位小数>,
      "price_change": <从工具获取的真实涨跌额，保留两位小数>,
      "percentage_change": <从工具获取的真实涨跌幅，保留两位小数>,
      "market_assessment": "<基于上述真实数据的简短分析，必须引用具体数字>"
    }

    示例（市场下跌情况）：
    {
      "index": "NASDAQ 100 (QQQ)",
      "data_source": "最新价: 518.23, 涨跌额: -7.85, 涨跌幅: -1.49%",
      "latest_close": 518.23,
      "price_change": -7.85,
      "percentage_change": -1.49,
      "market_assessment": "今日QQQ收于518.23点，下跌7.85点（-1.49%），市场呈现明显回调态势。"
    }

    **严格要求：market_assessment 中必须包含具体的数字，不允许出现模糊描述！**

  agent_role: market_analyst
  tools: [nasdaq_data_tool]

# --- 任务 2: 搜索当日重要财经新闻 ---
research_key_news:
  description: >
    **CRITICAL: You MUST search for NASDAQ 100 (QQQ) news ONLY. DO NOT search for Chinese stocks or A-shares.**

    使用 'search_tool' 搜索与当天纳斯达克100指数(NASDAQ 100/QQQ)波动直接相关的英文新闻。

    **必须使用英文关键词搜索，例如：**
    - "NASDAQ 100 today"
    - "QQQ ETF news"
    - "NVIDIA Apple Microsoft earnings"
    - "Federal Reserve interest rates"
    - "US tech stocks"

    **严禁搜索：**
    - 中国A股、上证指数、深证成指
    - 任何中文市场相关内容

    重点关注：
    - 美联储政策动态
    - 纳斯达克100权重股（NVIDIA, Apple, Microsoft, Amazon, Tesla等）
    - 美国宏观经济数据
    - 科技行业重大新闻

    **关键限制：**
    1. **仅允许调用一次**搜索工具 (search_news_tool)，使用英文查询。
    2. 获取到前 3-5 条最相关的新闻后**开始总结**，不要尝试反复搜索以追求完美。
    3. 只要有相关内容即可，不需要覆盖所有细节。

  expected_output: >
    一份详细的 Markdown 格式列表，包含 3-5 条相关性最高新闻摘要。
    每条摘要必须包括新闻来源、主要内容和对纳指的影响（例如：利好/利空/中性）。

    示例格式：
    ### 今日主要驱动因素
    - **[利好]** 摩根士丹利上调苹果评级：预计Vision Pro销售强劲。
    - **[利空]** 美联储主席鲍威尔表示抗通胀远未结束，暗示将继续高利率政策。
    - **[中性]** ...

  agent_role: news_researcher # 明确指派给 'news_researcher' 执行
  tools: [search_tool] # 明确使用搜索工具

# --- 任务 3: 撰写最终盘后总结报告 ---
write_final_report:
  description: >
    **CRITICAL: This report is about NASDAQ 100 (QQQ) ONLY. DO NOT include Chinese stock market information.**

    **你必须使用前面两个任务的输出结果：**
    1. 任务1（market_analyst）提供的 QQQ 真实数据（包含具体的收盘价、涨跌额、涨跌幅）
    2. 任务2（news_researcher）提供的纳斯达克相关新闻摘要

    **重要：你必须在报告中引用具体的数字！**
    - 必须包含任务1提供的具体收盘价、涨跌额、涨跌幅
    - 必须引用任务2提供的具体新闻内容

    综合上述数据和新闻，撰写一份专业的、结构化的，而且适合 Telegram 阅读的**纳斯达克100指数**中文盘后总结报告。
    注意：
    1. 严禁使用 # 字符作为标题。
    2. 使用 *文字* 语法对重点内容和标题进行加粗。
    3. 保持段落清晰。
    4. 严禁使用下划线 '_' 字符，如果必须表示，请使用空格代替。
    5. 确保所有的加粗符号 '*' 必须成对出现。
    6. 如果报告内容过长，请务必进行精简，确保总长度不超过 3000 字符。


    **严禁：**
    - 编造数据或使用模糊描述（如"以QQQ为追踪标的"而不给出具体数字）
    - 包含中国A股市场信息（上证指数、深证成指、创业板指数）
    - 包含任何非纳斯达克市场的内容

    报告必须逻辑清晰，先陈述具体数据，后解释驱动因素，并给出简短的展望。

  expected_output: >
    一份结构严谨、适合通过 Telegram 推送的 Markdown 报告。

    **报告必须包含前面任务提供的具体数字！例如：**
    - "纳斯达克100指数今日收于XXX.XX点，下跌/上涨XX.XX点（±X.XX%）"
    - 引用具体的新闻标题和内容

    报告必须包含以下**三个**部分：
    1. **标题和核心数据**：
       - 必须包含具体的收盘价、涨跌额、涨跌幅（来自任务1）
       - 使用粗体强调关键数字
       
    2. **市场驱动力分析**：
       - 必须引用任务2提供的具体新闻内容
       - 使用引用块（>）或列表格式
       - 标注利好/利空/中性
       
    3. **操盘建议**：
       - 基于上述具体数据和新闻做出判断
       - 给出明确的操作建议（加仓/减仓/观望）

    **严禁：**
    - 输出任何 JSON 格式
    - 使用模糊描述代替具体数字
    - 包含原始URL链接

  agent_role: content_creator # 明确指派给 'content_creator' 执行
  tools: [] # 撰写报告不需要外部工具
